package: test
name: Test
type: app
keywords: [test]
license: MIT
url: http://localhost
description: Test Package
info: This is a test package that can be used in UT

# Fake dependencies
# deps:
#   nodejs: 6.0.0 || >=6.7.1 <7.0.0
#   busybox: ^1.26.1

conf:
  self:
  - etc/package.json
  host:
    path: host
    self: 0
  port:
    path: vars.port

vars:
  self:
  - etc/package.json
  version:
    path: version

arch:
  self:
    src: [0.0.1, 0.1-beta]

tags:
  stable:
    src: 0.0.1
  latest:
    src: 0.1.2-beta

exec:
  start: test start
  stop: test stop

tasks:
  build:
  - test = ls /tmp
  - puts ${test}
  - glob ls ${PKGDIR}*
  - if !PREFIX?:
    - puts [x] PREFIX don't exists
    - exit 1
  - puts [#] Beginning the tests on ${PREFIX}
  - if PREFIX?:
    - puts [0] \${PREFIX} `${PREFIX}` exist
    - if !ok?:
      - ok = "0"
  - else:
    - puts [x] Env vars not taken into account
    - exit 1
  - if ok = 0:
    - puts [1] True test condition \${ok} `${ok}` printed
  - else:
    - puts [x] This else should not be printed, \${ok} not defined?
    - exit 1
  - if ok = "1":
    - puts [x] False test condition should not be printed
    - exit 1
  - elif false:
    - puts [x] Elif shouldn't be printed
  - else:
    - puts [2] else printed
  - if true:
    - puts [3] True test after else printed
    - if false:
      - puts [x] False test should not be printed
      - exit 1
    - elif true:
      - puts [4] True elif test inside true test printed
      - if true:
        - puts [5] Another true to be print
      - else:
        - puts [x] Don't print this else
        - exit 1
    - else:
      - puts [x] false else condition should not be printed
      - exit 5
    - puts [6] End of block printed
  - puts [7] version = ${VERSION}
  - puts [8] End of tests
  add:
  # # Template
  # - add test etc/test.conf
  - json.get etc/package.json vars.port
  - json.set etc/package.json vars.port 127
  - set etc/package.json host "localhost"
  - set etc/package.json server {}
  - read etc/package.json
  - set etc/package.json server.url "test"
  - get etc/package.json vars.port

  - npm help
